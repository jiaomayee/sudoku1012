# 数独技巧模块开发文档

## 开发进度概览

### 已完成的技巧模块
1. **基础技巧**：唯一数法 (Naked Single)
2. **候选数基础技巧**：
   - 候选数唯一法 (Notes Single)
   - 显性数对法 (Naked Pairs)
   - 隐性数对法 (Hidden Pairs)

### 已完成的功能模块
1. **技巧模块化**：将数对相关技巧整合到 `pairTechniques.js` 模块
2. **技巧管理器**：实现 `techniqueManager.js`，支持技巧选择、组合和管理
3. **技巧指示功能**：实现 `techniqueIndicator.js`，支持高亮显示、提示和应用解题步骤

## 技巧分类

根据难度和实现复杂度，数独技巧分为以下几类：

1. **基础技巧**：唯一数法等直接观察即可发现的技巧
2. **候选数基础技巧**：候选数唯一法、显性数对法等需要候选数支持的基础技巧
3. **中级技巧**：隐性数对法、显性三链数法等需要一定逻辑推理的技巧
4. **高级技巧**：X-Wing、Y-Wing、剑鱼法等复杂推理技巧

## 基础技巧指示功能要求

### 高亮样式
- 技巧涉及的单元格使用高亮显示，区分主要单元格和目标单元格
- 主要单元格使用绿色高亮（`#4CAF50`，透明度20%）
- 目标单元格使用蓝色高亮（`#2196F3`，透明度20%）
- 涉及的数字或候选数使用橙色高亮（`#FF9800`）
- 需要删除的候选数使用紫色高亮并添加删除线（`#9C27B0`）

### 预填数字显示
- 在应用技巧前，通过高亮或特殊样式显示将要填入的数字
- 提供明确的视觉指示，让用户理解技巧的应用结果

## 交互要求

### 技巧模式切换与退出机制
- 提供技巧模式进入/退出功能
- 退出技巧模式时清除所有高亮和提示
- 技巧模式下禁用普通编辑功能，专注于技巧学习

### 候选数删除无效检查机制
- 在删除候选数前检查是否会导致无效状态
- 验证删除操作的合法性，避免破坏数独规则
- 提供错误提示机制

### 刷新候选数按钮工作逻辑
- 点击刷新按钮时，重新计算并更新所有单元格的候选数
- 考虑已经应用的技巧和当前棋盘状态
- 保持与当前解题进度的一致性

### 技巧选择功能
- 通过导航区"设置"按钮可以列出并选择技巧
- 支持用户自定义技巧组合
- 已选择的技巧会被保存到本地存储

## 技巧算法详细逻辑

### 1. 唯一数法 (Naked Single)

**原理**：当某个单元格的同行、同列或同宫中已出现8个不同的数字时，该单元格只能填入剩余的那个数字。

**算法逻辑**：
1. 遍历棋盘上所有空格
2. 对于每个空格，收集其所在行、列、宫中已出现的数字
3. 计算剩余可能的数字，如果只剩下一个，则找到一个唯一数法机会

**返回结构**：
```javascript
{
  type: 'nakedSingle',
  description: '唯一数法',
  row: 行索引,
  col: 列索引,
  value: 唯一可能的数字,
  cells: [[row, col]],  // 涉及的单元格
  targetCells: [[row, col]],  // 目标单元格（将要填入数字的单元格）
  message: '描述信息',
  technique: '唯一数法',  // 技巧名称
  reason: '逻辑原因',    // 触发该技巧的原因
  result: {
    cell: [row, col],  // 操作的单元格
    action: 'fill',    // 操作类型（填入数字）
    value: 数字值      // 填入的数字
  }
}
```

### 2. 候选数唯一法 (Notes Single)

**原理**：当某个单元格的候选数中只有一个数字时，该单元格必须填入这个数字。

**算法逻辑**：
1. 遍历所有单元格
2. 对于每个空格，检查其候选数列表
3. 如果候选数列表中只有一个数字，则找到一个候选数唯一法机会
4. 进行候选数保护检查：如果提供了答案且计算结果与答案不符，则跳过

**返回结构**：
```javascript
{
  type: 'notesSingle',
  description: '候选数唯一法',
  row: 行索引,
  col: 列索引,
  value: 候选数中的唯一数字,
  cells: [[row, col]],
  targetCells: [[row, col]],
  notes: [唯一候选数],
  message: '描述信息',
  technique: '候选数唯一法',
  reason: '逻辑原因',
  result: {
    cell: [row, col],
    action: 'fill',
    value: 数字值
  }
}
```

### 3. 显性数对法 (Naked Pairs)

**原理**：在同一行、列或宫中，如果有两个单元格都只有相同的两个候选数，则这两个数字必定分别填入这两个单元格，因此可以从该行、列或宫的其他单元格的候选数中删除这两个数字。

**算法逻辑**：
1. 分别检查每一行、每一列和每一宫
2. 对于每一行/列/宫，收集所有只有两个候选数的单元格
3. 检查这些单元格中是否存在两个单元格拥有完全相同的候选数
4. 进行候选数保护检查：确保数对中的数字至少有一个与答案匹配
5. 检查该行/列/宫的其他单元格是否包含这两个候选数，如果有则可以删除

**返回结构**：
```javascript
{
  type: 'nakedPairRow', // 或 'nakedPairCol', 'nakedPairBox'
  description: '显性数对法(行)', // 或 '(列)', '(宫)'
  cells: [[row1, col1], [row2, col2]], // 形成数对的两个单元格
  values: [数字1, 数字2], // 数对中的两个数字
  targetCells: [[row3, col3], ...], // 受影响的单元格
  removableCandidates: [数字1, 数字2, ...], // 可以删除的候选数
  message: '描述信息',
  technique: '显性数对法',
  reason: '逻辑原因',
  result: {
    action: 'removeCandidates', // 操作类型（删除候选数）
    cells: [
      {
        cell: [row, col], // 要操作的单元格
        action: 'remove', // 移除操作
        values: [数字1, 数字2] // 要移除的候选数
      },
      ...
    ]
  }
}
```

### 4. 隐性数对法 (Hidden Pairs)

**原理**：在同一行、列或宫中，如果两个数字只能出现在两个特定的单元格中，那么这两个单元格必须填入这两个数字，因此可以从这两个单元格的候选数中删除其他数字。

**算法逻辑**：
1. 分别检查每一行、每一列和每一宫
2. 对于每一行/列/宫，统计每个数字可能出现的单元格位置
3. 检查是否存在两个数字，它们的可能位置集合完全相同且大小为2
4. 进行候选数保护检查：确保两个数字在对应单元格的答案中
5. 检查这两个单元格是否有除了这两个数字以外的候选数，如果有则可以删除

**返回结构**：
```javascript
{
  type: 'hiddenPairRow', // 或 'hiddenPairCol', 'hiddenPairBox'
  description: '隐性数对法(行)', // 或 '(列)', '(宫)'
  cells: [[row1, col1], [row2, col2]], // 隐性数对所在的两个单元格
  values: [数字1, 数字2], // 隐性数对中的两个数字
  targetCells: [[row1, col1], [row2, col2]], // 目标单元格
  removableCandidates: [其他候选数...], // 可以删除的候选数
  message: '描述信息',
  technique: '隐性数对法',
  reason: '逻辑原因',
  result: {
    action: 'removeCandidates',
    cells: [
      {
        cell: [row1, col1],
        action: 'remove',
        values: [其他候选数...]
      },
      {
        cell: [row2, col2],
        action: 'remove',
        values: [其他候选数...]
      }
    ]
  }
}
```

## 模块化结构

### 1. pairTechniques.js

包含数对相关的技巧实现：
- 候选数唯一法 (findNotesSingles)
- 显性数对法 (findNakedPairs)
- 隐性数对法 (findHiddenPairs)

每个技巧函数都支持：
- solution 参数用于候选数保护检查
- 返回结构包含 technique、reason 和 result 字段
- 多语言名称映射支持

### 2. techniqueManager.js

技巧管理模块，主要功能：
- 技巧分类管理（基础、候选数基础、中级、高级）
- 技巧启用/禁用控制
- 技巧设置本地存储
- 多语言支持
- 技巧优先级排序
- 组合技巧求解功能

### 3. techniqueIndicator.js

技巧指示功能模块，主要功能：
- 单元格高亮显示（主要单元格、目标单元格）
- 数值和候选数高亮显示
- 应用解题步骤功能
- 多语言描述支持
- 高亮样式管理和清除

## 统一函数使用规范

为了便于开发维护，技巧算法实现应遵循以下规范：

1. **参数统一**：所有技巧函数接受相同的参数结构 (board, pencilNotes, solution)
2. **返回格式统一**：返回对象包含 technique、reason 和 result 字段
3. **候选数保护**：统一使用 solution 参数进行候选数保护检查
4. **错误处理**：统一的错误日志记录格式
5. **语言支持**：通过统一的名称映射对象支持多语言

## 后续开发计划

1. 实现显性三链数法和隐性三链数法
2. 开发区块排除法相关技巧
3. 实现高级技巧如 X-Wing、Y-Wing 等
4. 完善多语言翻译支持
5. 开发技巧选择界面组件
6. 实现技巧应用的动画效果
7. 增加技巧统计和分析功能